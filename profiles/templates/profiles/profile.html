{% extends 'base.html' %}
{% load static %}
{% block title %} DN Fitness | {{ user.username|title }}'s Profile {% endblock %}

{% block page_header %}
    <div class="container header-container">
        <div class="row">
            <div class="col">
            
            </div>
        </div>
    </div>
{% endblock  %}

{% block content %}
    <div class="white-overlay"></div>
    <div class="container">
        <section class="row">
            <div class="col-12">
                <hr class="hr-black-long">
                <h2 class="text-black mb-4 text-center">Welcome back, <span>{{ user.username|title }}.</span></h2>
                <hr class="hr-black-long mb-5">
            </div>
        </section>
        <!--Profile Nav-->
        <section class="row">
            <div class="col-md-4 col-12">
                <div class="profile-nav checkout_row">
                    <ul class="list-group profile-navigation-list">
                        <a class="profile-nav-link-account text-black m-1" href='#'>
                            <li class="list-group-item active profile-nav-link-text" id="account-profile"><i class="fas fa-fw fa-user pr-1"></i>My Account</li>
                        </a>
                        <a class="profile-nav-link-account text-black m-1" href='#'>
                            <li class="list-group-item profile-nav-link-text" id="account-orders"><i class="fas fa-fw fa-shopping-basket pr-1"></i>My Orders</li>
                        </a>  
                        <a class="profile-nav-link-account text-black m-1" href='#'>
                            <li class="list-group-item profile-nav-link-text" id="account-logout"><i class="fas fa-fw fa-sign-out-alt pr-1"></i>Log Out</li>
                        </a>      
                    </ul>
                </div>
            </div>
        <!-- Account Information-->
        <div class="col-md-8 col-12 checkout_row" id="account-profile-panel">
            <div class="profile-dashboard">
                <h2 class="text-black text-center pb-3 text-heading-size">Contact Information</h2>
                <form id="update-profile-form" action="#" method="POST">
                {% csrf_token %} 
                {{ form|crispy }}
                <button class="btn orange-btn text-white rounded">Update Information</button>
            </form>
            </div>
        </div>

        <!-- Order Panel -->
        <div class="col-md-8 col-12 profile-dashboard-orders checkout_row" id="account-orders-panel">
            <div class="profile-dashboard">
                <h2 class="text-black text-center pb-3 text-heading-size">Your Orders</h2>
                {% if orders %}
                {% for order in orders %}
                <div class="profile-dashboard-order-panel">
                    <h5 class="text-black">Order Number:</h5>
                    <p class="text-black word-wrapper small-font-sizing">{{ order.order_number }}</p> 
                </div>
                {% for item in order.lineitems.all %}
                <section class="row profile-dashboard-orders-line-items">
                    <div class="col-md-4 col-5">
                        <div class="mw-100">
                            <img class="img-fluid rounded" src="{{ item.product.image.url }}" alt="{{ item.product.name }}">
                        </div>
                    </div>
                    <div class="col-md-6 col-7 align-items-center text-black d-flex">
                        <div class="profile-dashboard-order-details">
                            <h5>{{ item.product.name }}</h5>
                            <p class="my-0"><strong>€ {{ item.product.price }}</strong></p>
                            <p><strong>Qty:</strong> {{ item.quantity }}</p>
                        </div>
                    </div>
                </section>
                {% endfor %}
                <!--Order Total-->
                <section class="row">
                    <div class="col-md-6">
                        <h5 class="text-black pt-4">Order total: €{{ order.grand_total }}</h5>
                    </div>
                    <div class="col-md-6 mb-5">
                        <div class="profile-dashboard-orders-view">
                            <p class="text-black pt-4">View your order<a class="cart-colour" href="{% url 'order_history' order.order_number %}"> here!</a></p>
                        </div>
                    </div>
                </section>
                <hr class="hr-black-long">
                {% endfor %}
                {% else %}
                <div class="profile-dashboard-no-orders text-center">
                    <h4>No Orders!</h4>
                    <p>Check out our range of training classes!</p>
                    <a class="btn orange-btn rounded text-white" aria-label="Shop now" href="{% url 'products' %}">Shop Now</a>
                </div>
                {% endif %}
            </div>
        </div>
        <!-- Logout Panel -->
        <div class="col-md-8 col-12 checkout_row" id="account-profile-logout-panel">
            <div class="profile-dashboard text-center">
                <h2 class="text-black text-center text-heading-size">Log out?</h2>
                <p class="text-black text-center">Are you sure you wish to log out?</p>
                <a href="{% url 'account_logout' %}" class="btn orange-btn text-center text-white rounded">Log Out</a>
                <a href="{% url 'products' %}" class="btn orange-btn text-center text-white rounded">Continue Shopping</a>
            </div>
        </div>
    </div>

{% endblock  %}